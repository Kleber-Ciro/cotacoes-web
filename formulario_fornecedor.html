<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCjse7Bzw-vantrt1s7UXr_ev6QCMlwxC8",
    authDomain: "cotacoes---konect.firebaseapp.com",
    databaseURL: "https://cotacoes---konect-default-rtdb.firebaseio.com",
    projectId: "cotacoes---konect",
    storageBucket: "cotacoes---konect.appspot.com",
    messagingSenderId: "1037489090128",
    appId: "1:1037489090128:web:09998d990338d15e276b55"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const auth = firebase.auth();

  const emailInput = document.getElementById("email");
  const senhaInput = document.getElementById("senha");
  const btnLogin = document.getElementById("btnLogin");
  const btnPrimeiroAcesso = document.getElementById("btnPrimeiroAcesso");

  auth.onAuthStateChanged((user) => {
    if (user) {
      // já logado, redireciona direto para o painel
      window.location.href = "painel_fornecedor.html";
    }
  });

  btnLogin.addEventListener("click", () => {
    const email = emailInput.value;
    const senha = senhaInput.value;

    auth.signInWithEmailAndPassword(email, senha)
      .then(() => {
        window.location.href = "painel_fornecedor.html";
      })
      .catch((error) => {
        alert("Erro no login: " + error.message);
      });
  });

  btnPrimeiroAcesso.addEventListener("click", () => {
    const email = prompt("Digite seu e-mail:");
    const senha = prompt("Crie uma senha de 6 caracteres:");
    const razaoSocial = prompt("Razão Social:");
    const cnpj = prompt("CNPJ:");
    const vendedor = prompt("Nome do vendedor:");
    const whatsapp = prompt("WhatsApp:");
    const telefoneFixo = prompt("Telefone fixo:");

    if (senha.length < 6) {
      alert("A senha deve ter no mínimo 6 caracteres.");
      return;
    }

    auth.createUserWithEmailAndPassword(email, senha)
      .then((userCredential) => {
        const uid = userCredential.user.uid;
        const codigo = "FORN-" + Math.floor(Math.random() * 9000 + 1000); // Ex: FORN-2381

        db.ref("fornecedores/" + uid).set({
          razaoSocial,
          cnpj,
          email,
          vendedor,
          whatsapp,
          telefoneFixo,
          codigo
        }).then(() => {
          alert("Usuário criado com sucesso!");
          window.location.href = "painel_fornecedor.html";
        });
      })
      .catch((error) => {
        alert("Erro ao criar usuário: " + error.message);
      });
  });
</script>

