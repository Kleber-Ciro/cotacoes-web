
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel do Fornecedor</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
  <style>
    body {
      font-family: Arial;
      margin: 20px;
    }
    .alerta {
      background-color: #007bff;
      color: white;
      padding: 10px;
      margin-bottom: 20px;
      display: none;
    }
    .bloqueio {
      background-color: red;
      color: white;
      padding: 10px;
      margin-bottom: 20px;
      display: none;
    }
    #historicoBtn, #cotarBtn, #whatsappBtn {
      margin: 10px 5px;
      padding: 10px;
    }
  </style>
</head>
<body>
  <h2>Painel do Fornecedor</h2>

  <div class="alerta" id="alertaCotacao">Nova cotacao disponível para preenchimento! ✅</div>
  <div class="bloqueio" id="mensagemBloqueio">Horário para envio expirado!</div>

  <button id="cotarBtn" onclick="verificarHorarioECotar()">Preencher Cotacão</button>
  <button id="historicoBtn" onclick="window.location.href='historico-fornecedor.html'">Ver Histórico</button>
  <button id="whatsappBtn" onclick="compartilharWhatsapp()">Compartilhar Cotacão via WhatsApp</button>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCjse7Bzw-vantrt1s7UXr_ev6QCMlwxC8",
      authDomain: "cotacoes---konect.firebaseapp.com",
      databaseURL: "https://cotacoes---konect-default-rtdb.firebaseio.com",
      projectId: "cotacoes---konect",
      storageBucket: "cotacoes---konect.appspot.com",
      messagingSenderId: "1037489090128",
      appId: "1:1037489090128:web:09998d990338d15e276b55"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Exibir alerta se tiver cotacao nova
    db.ref("cotacoes").limitToLast(1).once("value", snapshot => {
      snapshot.forEach(cot => {
        const horarioLimite = cot.val().horarioLimite || "23:59";
        const agora = new Date();
        const [h, m] = horarioLimite.split(":");
        const limite = new Date();
        limite.setHours(parseInt(h), parseInt(m));

        if (agora <= limite) {
          document.getElementById("alertaCotacao").style.display = "block";
        }
      });
    });

    function verificarHorarioECotar() {
      db.ref("cotacoes").limitToLast(1).once("value", snapshot => {
        snapshot.forEach(cot => {
          const horarioLimite = cot.val().horarioLimite || "23:59";
          const agora = new Date();
          const [h, m] = horarioLimite.split(":");
          const limite = new Date();
          limite.setHours(parseInt(h), parseInt(m));

          if (agora <= limite) {
            window.location.href = "formulario_fornecedor.html";
          } else {
            document.getElementById("mensagemBloqueio").style.display = "block";
          }
        });
      });
    }

    function compartilharWhatsapp() {
      const fornecedorId = localStorage.getItem("fornecedor_fone"); // ou use sessionStorage
      if (!fornecedorId) {
        alert("Telefone do fornecedor não encontrado.");
        return;
      }
      const msg = encodeURIComponent("Confira sua cotação no sistema. Acesse com seu login e senha.");
      const link = `https://wa.me/55${fornecedorId}?text=${msg}`;
      window.open(link, '_blank');
    }
  </script>
</body>
</html>
