<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel do Fornecedor</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
      max-width: 700px;
      margin: auto;
      background-color: #f8f9fb;
    }
    h2 {
      color: #0055ff;
      margin-bottom: 20px;
    }
    .botao {
      display: block;
      width: 100%;
      margin: 15px 0;
      padding: 15px;
      font-size: 16px;
      background-color: #0055ff;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    .botao:hover {
      background-color: #003dcc;
    }
    .alerta {
      padding: 15px;
      background-color: #e8f4ff;
      border-left: 6px solid #0055ff;
      margin-bottom: 20px;
      font-weight: bold;
      color: #003e99;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h2>Bem-vindo ao Painel do Fornecedor</h2>

  <div id="alertaCotacao"></div>

  <button class="botao" onclick="window.location.href='formulario_fornecedor.html'">
    九꽲잺 Preencher Cota칞칚o
  </button>

  <button class="botao" onclick="abrirHistorico()">
    游늵 Ver Hist칩rico de Cota칞칫es
  </button>

  <button class="botao" onclick="compartilharWhatsApp()">
    游닋 Compartilhar Cota칞칚o via WhatsApp
  </button>

  <script>
    // Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCjse7Bzw-vantrt1s7UXr_ev6QCMlwxC8",
      authDomain: "cotacoes---konect.firebaseapp.com",
      databaseURL: "https://cotacoes---konect-default-rtdb.firebaseio.com",
      projectId: "cotacoes---konect",
      storageBucket: "cotacoes---konect.appspot.com",
      messagingSenderId: "1037489090128",
      appId: "1:1037489090128:web:09998d990338d15e276b55"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Verifica칞칚o de cota칞칚o dispon칤vel
    function verificarCotacaoDisponivel() {
      const alertaDiv = document.getElementById("alertaCotacao");
      const agora = new Date();

      db.ref("cotacoes").limitToLast(1).once("value").then(snapshot => {
        snapshot.forEach(cot => {
          const horarioLimite = cot.val().horarioLimite || "23:59";
          const [hora, minuto] = horarioLimite.split(":");
          const limite = new Date();
          limite.setHours(hora);
          limite.setMinutes(minuto);

          if (agora <= limite) {
            alertaDiv.innerHTML = `<div class='alerta'>游닉 Uma nova cota칞칚o est치 dispon칤vel para preenchimento!</div>`;
          } else {
            alertaDiv.innerHTML = "";
          }
        });
      });
    }

    // Redirecionar hist칩rico
    function abrirHistorico() {
      const codigo = localStorage.getItem("fornecedorCodigo");
      if (!codigo) {
        alert("C칩digo do fornecedor n칚o encontrado. Fa칞a login novamente.");
        return;
      }
      window.location.href = `historico_fornecedor.html?forn=${codigo}`;
    }

    // Compartilhar via WhatsApp
    function compartilharWhatsApp() {
      const fone = localStorage.getItem("fornecedorFone");
      if (!fone) {
        alert("WhatsApp n칚o encontrado. Fa칞a login novamente.");
        return;
      }
      const msg = encodeURIComponent("Ol치! Segue minha cota칞칚o preenchida.");
      window.open(`https://wa.me/55${fone}?text=${msg}`, "_blank");
    }

    verificarCotacaoDisponivel();
  </script>
</body>
</html>
