<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Painel do Fornecedor</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    h2 {
      color: #0055ff;
    }
    .alerta {
      padding: 12px;
      background-color: #fffae6;
      border-left: 6px solid #ffc107;
      margin-bottom: 20px;
      font-weight: bold;
    }
    .botoes button {
      display: block;
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      background-color: #0055ff;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
    .botoes button:hover {
      background-color: #0041c4;
    }
  </style>
</head>
<body>
  <h2>Bem-vindo ao Painel do Fornecedor</h2>
  <div id="alertaCotacao"></div>
  <div class="botoes">
    <button onclick="window.location.href='preencher_cotacao.html'" id="btnPreencherCotacao" style="display:none">Preencher Cotacao Disponível</button>
    <button onclick="window.location.href='historico_fornecedor.html'">Ver Histórico de Cotações</button>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AlzaSyCjse7Bzw-vantrt1s7UXr_ev6QCMlwxC8",
      authDomain: "cotacoes---konect.firebaseapp.com",
      databaseURL: "https://cotacoes---konect-default-rtdb.firebaseio.com",
      projectId: "cotacoes---konect",
      storageBucket: "cotacoes---konect.appspot.com",
      messagingSenderId: "1037489090128",
      appId: "1:1037489090128:web:09998d990338d15e276b55"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const codForn = localStorage.getItem("codigoFornecedor");

    function verificarCotacaoDisponivel() {
      const alertaDiv = document.getElementById("alertaCotacao");
      const botao = document.getElementById("btnPreencherCotacao");

      db.ref("cotacoes").once("value").then(snapshot => {
        let encontrou = false;
        const agora = new Date();

        snapshot.forEach(cot => {
          const dados = cot.val();
          const horarioLimite = dados.horarioLimite || "23:59";
          const dataCot = new Date(dados.data + 'T' + horarioLimite);

          if (agora <= dataCot && dados.produtos) {
            for (const cod in dados.produtos) {
              if (dados.produtos[cod].fornecedor === codForn) {
                encontrou = true;
                break;
              }
            }
          }
        });

        if (encontrou) {
          alertaDiv.innerHTML = '<div class="alerta">\u26A0\ufe0f Uma nova cotação está disponível para preenchimento!</div>';
          botao.style.display = 'block';
        } else {
          alertaDiv.innerHTML = '<p style="color:gray">Nenhuma cotação disponível no momento.</p>';
        }
      });
    }

    if (codForn) {
      verificarCotacaoDisponivel();
    } else {
      document.body.innerHTML = '<p style="color:red">Erro: Nenhum fornecedor logado. Acesse novamente o sistema.</p>';
    }
  </script>
</body>
</html>
