<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Nova Cotação</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 800px;
      margin: auto;
    }
    h2 {
      color: #0055ff;
    }
    label {
      display: block;
      margin-top: 12px;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .produto-item {
      margin-top: 8px;
    }
    button {
      margin-top: 20px;
      padding: 12px;
      background-color: #0055ff;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background-color: #003dcc;
    }
  </style>
</head>
<body>
  <h2>Nova Cotação</h2>

  <label>Número da Cotação:</label>
  <input type="text" id="numeroCotacao" readonly>

  <label>Data de Envio:</label>
  <input type="date" id="dataEnvio" required>

  <label>Horário Limite de Resposta:</label>
  <input type="time" id="horarioLimite" required>

  <h3>Selecionar Produtos:</h3>
  <div id="listaProdutos"></div>

  <button onclick="gerarCotacao()">Gerar Cotação</button>

  <script>
    const firebaseConfig = {
      apiKey: "AlzaSyCjse7Bzw-vantrt1s7UXr_ev6QCMlwxC8",
      authDomain: "cotacoes---konect.firebaseapp.com",
      databaseURL: "https://cotacoes---konect-default-rtdb.firebaseio.com",
      projectId: "cotacoes---konect",
      storageBucket: "cotacoes---konect.appspot.com",
      messagingSenderId: "1037489090128",
      appId: "1:1037489090128:web:09998d990338d15e276b55"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    document.getElementById("numeroCotacao").value = "COT-" + Date.now();

    // Listar produtos cadastrados
    db.ref("produtos").once("value").then(snapshot => {
      const lista = document.getElementById("listaProdutos");
      snapshot.forEach(prod => {
        const id = prod.key;
        const nome = prod.val().descricao;
        const div = document.createElement("div");
        div.className = "produto-item";
        div.innerHTML = `<input type='checkbox' value='${id}'> ${nome}`;
        lista.appendChild(div);
      });
    });

    function gerarCotacao() {
      const numero = document.getElementById("numeroCotacao").value;
      const dataEnvio = document.getElementById("dataEnvio").value;
      const horario = document.getElementById("horarioLimite").value;
      const selecionados = document.querySelectorAll("#listaProdutos input[type=checkbox]:checked");

      if (selecionados.length === 0) return alert("Selecione ao menos um produto!");

      const produtosCotacao = {};
      selecionados.forEach(input => {
        produtosCotacao[input.value] = {
          preco: null,
          fornecedor: null,
          comprado: false
        };
      });

      db.ref("cotacoes/" + numero).set({
        data: dataEnvio,
        horarioLimite: horario,
        produtos: produtosCotacao
      }).then(() => {
        alert("Cotação gerada com sucesso!");
        window.location.href = "dashboard.html";
      });
    }
  </script>
</body>
</html>
